<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="/fontawesome/css/fontawesome.css" rel="stylesheet">
<link href="/fontawesome/css/brands.css" rel="stylesheet">
<link href="/fontawesome/css/solid.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  <title>气象运算模式WRF使用教程 | Kizureina&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="出于一些麻烦的原因，我最近开始给老师跑WRF算法，用于做相当复杂的气象运算。说实话，编译一次需要用gcc和gfortran两个编译器并行跑四十分钟才能完成的代码真是第一次见。单是第一步的生成可执行文件就花了不少功夫，所以记录下来好了。不管怎么说，也算是有趣的经验吧，虽然快把我累死了。  首先给读者讲两个常识：  如果你从来没有了解过你将要上手的软件，最好不要随手搜一个教程跟着做，尤其不要搜中文教">
<meta property="og:type" content="article">
<meta property="og:title" content="气象运算模式WRF使用教程">
<meta property="og:url" content="https://kizureina.github.io/2023/07/13/Kit-of-using-WRF-module-for-prediction/index.html">
<meta property="og:site_name" content="Kizureina&#39;s Blog">
<meta property="og:description" content="出于一些麻烦的原因，我最近开始给老师跑WRF算法，用于做相当复杂的气象运算。说实话，编译一次需要用gcc和gfortran两个编译器并行跑四十分钟才能完成的代码真是第一次见。单是第一步的生成可执行文件就花了不少功夫，所以记录下来好了。不管怎么说，也算是有趣的经验吧，虽然快把我累死了。  首先给读者讲两个常识：  如果你从来没有了解过你将要上手的软件，最好不要随手搜一个教程跟着做，尤其不要搜中文教">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s1.ax1x.com/2023/07/13/pCh2l3n.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/07/13/pCh2a4J.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/07/13/pCh2XCj.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/07/13/pChRHQ1.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/07/19/pCTxxzQ.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/07/19/pCTzFoV.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/07/19/pC7kZrD.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/07/19/pC7kQPI.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/07/21/pCbnqun.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/07/21/pCbuVUK.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/07/19/pC7kTsO.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/07/13/pChRHQ1.png">
<meta property="article:published_time" content="2023-07-13T06:54:55.000Z">
<meta property="article:modified_time" content="2023-07-23T16:03:53.031Z">
<meta property="article:author" content="Kizurena">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2023/07/13/pCh2l3n.png">
  
    <link rel="alternate" href="/atom.xml" title="Kizureina's Blog" type="application/atom+xml">
  
  
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-192.png" sizes="192x192">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-192.png" sizes="192x192">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/assets/banner.png" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="shadow   ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>Kizureina's Blog </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="material-symbols-rounded light-mode-icon">wb_sunny</span>
      <span class="material-symbols-rounded dark-mode-icon">dark_mode</span>
    </a>
    
      <a id="nav-rss-link" class="nav-icon mobile-hide" href="/atom.xml" title="RSS 订阅">
        <span class="material-symbols-rounded rss">rss_feed</span>
      </a>
    
    <a id="nav-search-btn" class="nav-icon" title="搜索" style="display: none;">
      <span class="material-symbols-rounded">search</span>
    </a>
    <div id="nav-menu-btn" class="nav-icon">
      <span class="material-symbols-rounded">menu</span>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
    
      <a class="nav-dropdown-link" href="/atom.xml" title="RSS 订阅">RSS</a>
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/assets/avatar.png></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">Kizureina </div>
      <div class="dot"></div>
      <div class="subtitle">I know nothing except the fact of my ignorance. </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/Kizureina" title="GitHub"><i class="fa-brands fa-github"></i></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">分类</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/Reverse/">
                Reverse
                <div class="category-count">1</div>
            </a>
        
            <a class="category-link" href="/categories/WebSec/">
                WebSec
                <div class="category-count">5</div>
            </a>
        
            <a class="category-link" href="/categories/Web/">
                Web
                <div class="category-count">14</div>
            </a>
        
            <a class="category-link" href="/categories/MISC/">
                MISC
                <div class="category-count">1</div>
            </a>
        
            <a class="category-link" href="/categories/ACG/">
                ACG
                <div class="category-count">3</div>
            </a>
        
            <a class="category-link" href="/categories/EE/">
                EE
                <div class="category-count">2</div>
            </a>
        </div>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">标签</h3>
      <ul class="widget-tag-list" itemprop="keywords"><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Comic/" rel="tag">Comic</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Galgame/" rel="tag">Galgame</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/RCE/" rel="tag">RCE</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Reverse-shell/" rel="tag">Reverse shell</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/java-RCE/" rel="tag">java RCE</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" rel="tag">嵌入式</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E7%A1%AC%E4%BB%B6/" rel="tag">硬件</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">归档</h3>
      
      
        <a class="archive-link" href="/archives/2023/07 ">
          七月 2023 
          <div class="archive-count">4 </div>
        </a>
      
        <a class="archive-link" href="/archives/2023/06 ">
          六月 2023 
          <div class="archive-count">1 </div>
        </a>
      
        <a class="archive-link" href="/archives/2023/03 ">
          三月 2023 
          <div class="archive-count">2 </div>
        </a>
      
        <a class="archive-link" href="/archives/2023/02 ">
          二月 2023 
          <div class="archive-count">1 </div>
        </a>
      
        <a class="archive-link" href="/archives/2023/01 ">
          一月 2023 
          <div class="archive-count">4 </div>
        </a>
      
        <a class="archive-link" href="/archives/2022/12 ">
          十二月 2022 
          <div class="archive-count">3 </div>
        </a>
      
        <a class="archive-link" href="/archives/2022/11 ">
          十一月 2022 
          <div class="archive-count">2 </div>
        </a>
      
        <a class="archive-link" href="/archives/2022/09 ">
          九月 2022 
          <div class="archive-count">2 </div>
        </a>
      
        <a class="archive-link" href="/archives/2022/06 ">
          六月 2022 
          <div class="archive-count">1 </div>
        </a>
      
        <a class="archive-link" href="/archives/2022/04 ">
          四月 2022 
          <div class="archive-count">1 </div>
        </a>
      
        <a class="archive-link" href="/archives/2022/03 ">
          三月 2022 
          <div class="archive-count">1 </div>
        </a>
      
        <a class="archive-link" href="/archives/2022/02 ">
          二月 2022 
          <div class="archive-count">1 </div>
        </a>
      
        <a class="archive-link" href="/archives/2022/01 ">
          一月 2022 
          <div class="archive-count">3 </div>
        </a>
      
        <a class="archive-link" href="/archives/2021/12 ">
          十二月 2021 
          <div class="archive-count">1 </div>
        </a>
      
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">最新文章</h3>
      <ul>
        
          <li>
            <a href="/2023/07/25/BLE-KeyBoard-based-STM32/">手搓蓝牙机械键盘——基于ESP32、STM32、CH573</a>
          </li>
        
          <li>
            <a href="/2023/07/24/Thinking-of-Sakura-no-Uta/">《樱之诗》随想</a>
          </li>
        
          <li>
            <a href="/2023/07/13/Kit-of-using-WRF-module-for-prediction/">气象运算模式WRF使用教程</a>
          </li>
        
          <li>
            <a href="/2023/07/07/The-exp-of-Redis-unauthorized/">Redis未授权访问原理及利用</a>
          </li>
        
          <li>
            <a href="/2023/06/05/Start-of-Java-Sec-command-execute-and-reflection/">Java安全入门：命令执行，反射与反序列化</a>
          </li>
        
      </ul>
    </div>
  </div>

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       

<article id="post-Kit-of-using-WRF-module-for-prediction" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        气象运算模式WRF使用教程
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2023-07-13T06:54:55.000Z" itemprop="datePublished">2023-07-13</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/categories/MISC/">MISC</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            3.7k 词 
          </div>
        </div>
        
      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <blockquote>
<p>出于一些麻烦的原因，我最近开始给老师跑WRF算法，用于做相当复杂的气象运算。说实话，编译一次需要用gcc和gfortran两个编译器并行跑四十分钟才能完成的代码真是第一次见。单是第一步的生成可执行文件就花了不少功夫，所以记录下来好了。不管怎么说，也算是有趣的经验吧，虽然快把我累死了。</p>
</blockquote>
<p>首先给读者讲两个常识：</p>
<ol>
<li>如果你从来没有了解过你将要上手的软件，最好不要随手搜一个教程跟着做，尤其不要搜中文教程，因为这些教程可能本身就有错误，或者早已经过时。最高效的方法是去找官方网站找官方文档，或者Github官方仓库去找README。</li>
<li>遇到模式编译或运行中的错误，<strong>千万</strong>不要在国内网站上浪费时间，把遇到的问题用英文描述出来去官方论坛搜，找不到就去Github对应的项目搜issue，再不行就Google一下，把时间花在CSDN之类的网站上只会让你更迷惑。</li>
</ol>
<p>以下是与WRF相关非常重要的参考URL:</p>
<ol>
<li><p>WRF构建详细过程的官方教程：<a target="_blank" rel="noopener" href="https://www2.mmm.ucar.edu/wrf/OnLineTutorial/compilation_tutorial.php">How to Compile WRF: The Complete Process</a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pCh2l3n"><img src="https://s1.ax1x.com/2023/07/13/pCh2l3n.png" alt="pCh2l3n.png"></a></p>
</li>
<li><p>WRF运行官方教程：<a target="_blank" rel="noopener" href="https://www2.mmm.ucar.edu/wrf/OnLineTutorial/">WRF–ARW Online Tutorial</a></p>
<p>其中包含详细配置参数解释和运行命令指南。</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pCh2a4J"><img src="https://s1.ax1x.com/2023/07/13/pCh2a4J.png" alt="pCh2a4J.png"></a></p>
</li>
<li><p>WRF官方论坛：<a target="_blank" rel="noopener" href="https://forum.mmm.ucar.edu/">WRF &amp; MPAS-A Support Forum</a></p>
<p>绝大多数问题都能搜索到答案。</p>
</li>
</ol>
<h2 id="WRF简介"><a href="#WRF简介" class="headerlink" title="WRF简介"></a>WRF简介</h2><p>WRF（Weather Research and Forecasting）是一个先进的开源天气预报模型系统，由美国国家大气研究中心（NCAR）、美国国家海洋和大气管理局（NOAA）、其他大学和研究机构的科学家们共同开发。WRF模型系统被广泛用于天气和气候研究、天气预报、气候模拟等领域。</p>
<p>WRF模型是一个多尺度、多分辨率的大气模型系统，可以模拟全球范围内的天气现象，也可以以更高的空间分辨率针对特定地区进行详细的天气模拟。它融合了动力学、物理过程、辐射传输等多个方面的数值模拟技术，能够准确地描述大气中的各种物理过程，如动力学、热力学、湍流、辐射、陆面过程等。</p>
<p>WRF模型系统具有以下特点和优势：</p>
<ol>
<li><p>多尺度模拟能力：WRF模型可以在不同的水平分辨率下运行，从全球范围到小尺度的局地区域模拟，适用于不同尺度的气象研究和预报需求。</p>
</li>
<li><p>可配置性和可扩展性：WRF模型系统具有丰富的配置选项，可以根据用户需求选择不同的物理参数方案、边界条件和模拟设置，同时也支持与其他模型和数据源进行耦合和扩展。</p>
</li>
<li><p>开源和共享：WRF模型以开源方式发布，用户可以自由访问和使用，同时科学家们通过开放的交流和共享社区不断改进和优化模型系统。</p>
</li>
<li><p>多用途应用：WRF模型可用于天气预报、气候研究、环境模拟等多个领域。它被广泛应用于国内外的气象预报业务、科学研究机构和大学中，在气候变化、极端天气事件等领域发挥了重要作用。</p>
</li>
</ol>
<p>总之，WRF模型是一个功能强大、灵活可配置的大气模型系统，提供高分辨率的天气模拟和预报能力，被广泛应用于天气和气候研究以及气象预报业务中。</p>
<p>简而言之，WRF用于输入静态地理数据和初始参数，来预测之后或之间的详细预测数据，WRF是开源软件，可以很容易的获取。</p>
<h2 id="WRF构建"><a href="#WRF构建" class="headerlink" title="WRF构建"></a>WRF构建</h2><p>WRF构建相当复杂，主要流程如下：</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pCh2XCj"><img src="https://s1.ax1x.com/2023/07/13/pCh2XCj.png" alt="pCh2XCj.png"></a></p>
<p>或者说：依赖库配置&#x3D;&#x3D;&gt;依赖库测试&#x3D;&#x3D;&gt;WRF编译构建&#x3D;&#x3D;&gt;WPS编译构建&#x3D;&#x3D;&gt;静态地理数据下载配置&#x3D;&#x3D;&gt;模式选择</p>
<p>如果你对WRF的构建一无所知，又英语苦手，可以先看下主要流程，参考下随便就能搜到的<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42372313/article/details/121878090">中文教程</a>即可，但实际操作构建编译最好还是按照官方来。</p>
<h3 id="依赖库安装"><a href="#依赖库安装" class="headerlink" title="依赖库安装"></a>依赖库安装</h3><p>WRF需要下面五个主要依赖：<br><a target="_blank" rel="noopener" href="https://www2.mmm.ucar.edu/wrf/OnLineTutorial/compile_tutorial/tar_files/netcdf-c-4.7.2.tar.gz">netcdf-c-4.7.2</a><br><a target="_blank" rel="noopener" href="https://www2.mmm.ucar.edu/wrf/OnLineTutorial/compile_tutorial/tar_files/netcdf-fortran-4.5.2.tar.gz">netcdf-fortran-4.5.2</a><br><a target="_blank" rel="noopener" href="https://www2.mmm.ucar.edu/wrf/OnLineTutorial/compile_tutorial/tar_files/jasper-1.900.1.tar.gz">Jasper-1.900.1</a><br><a target="_blank" rel="noopener" href="https://www2.mmm.ucar.edu/wrf/OnLineTutorial/compile_tutorial/tar_files/libpng-1.2.50.tar.gz">libpng-1.2.50</a><br><a target="_blank" rel="noopener" href="https://www2.mmm.ucar.edu/wrf/OnLineTutorial/compile_tutorial/tar_files/zlib-1.2.11.tar.gz">zlib-1.2.11</a></p>
<p>另外需要一个并行计算的依赖：</p>
<p><a target="_blank" rel="noopener" href="https://www2.mmm.ucar.edu/wrf/OnLineTutorial/compile_tutorial/tar_files/mpich-3.0.4.tar.gz">mpich-3.0.4</a></p>
<p>装依赖库看起来容易，但一旦出问题很难解决。这几个库里最重要的是用于气象数据格式化的<em>netcdf</em>，再比较早的版本里netcdf(for c)和netcdff(for fortran)是合在一个库里的，但这种会导致版本较新的WRF V4.0报错：</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pChRHQ1"><img src="https://s1.ax1x.com/2023/07/13/pChRHQ1.png" alt="pChRHQ1.png"></a></p>
<p>而且因为编译不会中止，所以非常浪费时间，所以依赖库一定要确保不出问题。</p>
<p>另外mpich如果不安装，则在WPS和WRF的编译选项里都要选择<strong>串行编译</strong>。</p>
<h3 id="WRF编译"><a href="#WRF编译" class="headerlink" title="WRF编译"></a>WRF编译</h3><p>编译的流程是先做配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br></pre></td></tr></table></figure>

<p>有非常多选项可选，需要安装你的依赖和配置做选择，例如编译器gcc+gfrotran的话就用GNU，有mpich就用并行编译。注意，这里的选项很重要，如果有问题必定编译出错。</p>
<p>然后编译：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./compile case_name &gt;&amp; log.compile</span><br></pre></td></tr></table></figure>

<p>case_name是编译命令接收的参数，其实这行命令是把编译的所有日志重定向到log里。</p>
<p>一般使用真实数据都用<code>./compile em_real</code></p>
<p>编译完成后，如果成功会显示Successfully Build，并且会生成可执行文件：</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pCTxxzQ"><img src="https://s1.ax1x.com/2023/07/19/pCTxxzQ.png" alt="pCTxxzQ.png"></a></p>
<blockquote>
<p>wrf.exe (model executable)<br>real.exe (real data initialization)<br>ndown.exe (one-way nesting)<br>tc.exe (for tc bogusing–serial only)</p>
</blockquote>
<p>使用下面这条命令即可验证：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -<span class="built_in">ls</span> main/*.exe</span><br></pre></td></tr></table></figure>

<p>编译这步耗时很长，按照官方文档说至少也要半小时，而且很容易出错。</p>
<p>注意：如果编译失败了，重新编译时需要先用<code>./clean</code>清除原本配置。</p>
<h3 id="WPS编译"><a href="#WPS编译" class="headerlink" title="WPS编译"></a>WPS编译</h3><p>首先设置环境变量，如何与WRF一样配置<code>./configure</code></p>
<p>同样有很多选项，选择对应的即可。</p>
<p>然后运行命令<code>./compile &gt;&amp; log.compile</code>编译即可。</p>
<p>WPS编译相比之下要快的多，而且不那么容易出错，成功之后应该有如下几个可执行文件：</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pCTzFoV"><img src="https://s1.ax1x.com/2023/07/19/pCTzFoV.png" alt="pCTzFoV.png"></a></p>
<p>至此就完成了WPS编译。</p>
<h3 id="静态地理数据下载"><a href="#静态地理数据下载" class="headerlink" title="静态地理数据下载"></a>静态地理数据下载</h3><p>这一步没什么好说的，看文档就可以了，注意一定要下载完整，而且留出足够的存储。</p>
<p>下载地址：<a target="_blank" rel="noopener" href="http://www2.mmm.ucar.edu/wrf/users/download/get_sources_wps_geog.html">http://www2.mmm.ucar.edu/wrf/users/download/get_sources_wps_geog.html</a></p>
<p>另外路径需要注意与WPS默认配置对应，WPS的namelist.wps默认为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geog_data_path = ´path_to_directory/Build_WRF/WPS_GEOG´</span><br></pre></td></tr></table></figure>

<h3 id="输入数据下载和模式选择"><a href="#输入数据下载和模式选择" class="headerlink" title="输入数据下载和模式选择"></a>输入数据下载和模式选择</h3><p>输入数据在<a target="_blank" rel="noopener" href="https://rda.ucar.edu/datasets/ds084.1/dataaccess/">这个网站</a>下载，如果GFS的话文件名格式应该是类似与<code>gfs.0p25.2022061312.f000.grib2</code>。这个文件名是说这个数据是20220613的12时的第0时次，也就是12点的数据。</p>
<p>注意f000是指预测多少时次，也就是往后推多少时次，例如<code>gfs.0p25.2022061306.f003.grib2</code>是6时的第3时次，需要后推三个时次，也就是<strong>9点</strong>的数据。</p>
<p>这个信息在写输入配置时非常重要。</p>
<p>然后选择em_real模式来跑真实数据，就可以开始正式跑WRF了。</p>
<h2 id="WRF预处理：运行WPS"><a href="#WRF预处理：运行WPS" class="headerlink" title="WRF预处理：运行WPS"></a>WRF预处理：运行WPS</h2><p>但实际上，现在还不能跑WRF，因为WRF输入数据是nc格式，但是GFS输入数据是grib2，所以需要<strong>对数据做预处理</strong>（貌似类似于LAPS和RAMS的关系）。</p>
<p>跑WPS实际上就是运行刚才编译出来的三个exe文件，关键在于写namelist.wps的输入配置。</p>
<p>具体WPS流程是：</p>
<ol>
<li>geogrid.exe处理静态地理数据</li>
<li>ungrib.exe处理输入的GFS数据，用于转换格式</li>
<li>metgrib.exe将前两个输出文件做运算处理，输出WRF的输入文件。</li>
</ol>
<p>关键在于写namelist.wps配置，具体参数解释可详见<a target="_blank" rel="noopener" href="https://www2.mmm.ucar.edu/wrf/users/namelist_best_prac_wps.html">官方文档</a>。</p>
<p>其实可以分为几个部分，各自是对应可执行文件的配置，其中公用的是&amp;share部分：</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&amp;share</span><br><span class="line">wrf_core = <span class="string">&#x27;ARW&#x27;</span>,</span><br><span class="line">max_dom = <span class="number">1</span>,</span><br><span class="line">start_date = <span class="string">&#x27;2022-06-13_09:00:00&#x27;</span>,</span><br><span class="line">end_date = <span class="string">&#x27;2022-06-13_12:00:00&#x27;</span>, </span><br><span class="line">interval_seconds = <span class="number">10800</span>,</span><br><span class="line">io_form_geogrid = <span class="number">2</span>, </span><br></pre></td></tr></table></figure>

<p>起始时间和结束时间是输入数据的起止点，中间的数据由WRF算法算出来。</p>
<p>interval_seconds是间隔，最后是配置输出格式为nc。</p>
<h3 id="处理静态地理数据–geogrid-exe"><a href="#处理静态地理数据–geogrid-exe" class="headerlink" title="处理静态地理数据–geogrid.exe"></a>处理静态地理数据–geogrid.exe</h3><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&amp;geogrid</span><br><span class="line"> parent_id         =   <span class="number">1</span>,</span><br><span class="line"> parent_grid_ratio =   <span class="number">1</span>,</span><br><span class="line"> i_parent_start    =   <span class="number">1</span>,</span><br><span class="line"> j_parent_start    =   <span class="number">1</span>,</span><br><span class="line"> e_we              =  <span class="number">100</span>,</span><br><span class="line"> e_sn              =  <span class="number">100</span>,</span><br><span class="line"> <span class="comment">!</span></span><br><span class="line"> <span class="comment">!!!!!!!!!!!!!!!!!!!!!!!!!!!! IMPORTANT NOTE !!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></span><br><span class="line"> <span class="comment">! The default datasets used to produce the MAXSNOALB and ALBEDO12M</span></span><br><span class="line"> <span class="comment">! fields have changed in WPS v4.0. These fields are now interpolated</span></span><br><span class="line"> <span class="comment">! from MODIS-based datasets.</span></span><br><span class="line"> <span class="comment">!</span></span><br><span class="line"> <span class="comment">! To match the output given by the default namelist.wps in WPS v3.9.1,</span></span><br><span class="line"> <span class="comment">! the following setting for geog_data_res may be used:</span></span><br><span class="line"> <span class="comment">!</span></span><br><span class="line"> <span class="comment">! geog_data_res = &#x27;maxsnowalb_ncep+albedo_ncep+default&#x27;, &#x27;maxsnowalb_ncep+albedo_ncep+default&#x27;, </span></span><br><span class="line"> <span class="comment">!</span></span><br><span class="line"> <span class="comment">!!!!!!!!!!!!!!!!!!!!!!!!!!!! IMPORTANT NOTE !!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></span><br><span class="line"> <span class="comment">!</span></span><br><span class="line"> geog_data_res = <span class="string">&#x27;default&#x27;</span>,<span class="string">&#x27;default&#x27;</span>,</span><br><span class="line"> dx = <span class="number">100</span>,</span><br><span class="line"> dy = <span class="number">100</span>,</span><br><span class="line"> map_proj = <span class="string">&#x27;lambert&#x27;</span>,</span><br><span class="line"> ref_lat   =  <span class="number">25.09</span>,</span><br><span class="line"> ref_lon   =  <span class="number">102.92</span>,</span><br><span class="line"> truelat1  =  <span class="number">30.0</span>,</span><br><span class="line"> truelat2  =  <span class="number">60.0</span>,</span><br><span class="line"> stand_lon =  <span class="number">120.0</span>,</span><br><span class="line"> geog_data_path = <span class="string">&#x27;/public/home/demo_cuit/hck/Build_WRF/WPS/WPS_GEOG/&#x27;</span></span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<p>这个是处理静态地理数据的配置，其中有好几个需要仔细配置的地方。</p>
<p>e_we和e_sn是网格东西和南北尺寸，即WRF算法的计算<strong>网格范围</strong>，官方文档建议不应小于100*100。</p>
<p>dx和dy是x和y方向上的网格距离或分辨率，实际上就是WRF<strong>输入数据的分辨率</strong>。</p>
<p>ref_lat和ref_lon是输入数据的经纬度。</p>
<p>geog_data_path是静态地理数据的路径。</p>
<p>配置好就可以跑geogrid.exe了。</p>
<p>直接一行命令即可：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./geogrid.exe &gt;&amp; log.geogrid</span><br></pre></td></tr></table></figure>

<h3 id="处理输入数据–ungrib-exe"><a href="#处理输入数据–ungrib-exe" class="headerlink" title="处理输入数据–ungrib.exe"></a>处理输入数据–ungrib.exe</h3><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;ungrib</span><br><span class="line"> out_format = <span class="string">&#x27;WPS&#x27;</span>,</span><br><span class="line"> prefix = <span class="string">&#x27;FILE&#x27;</span>,</span><br></pre></td></tr></table></figure>

<p>这个部分的namelist很简单，也没什么要修改的。</p>
<p>但跑数据前需要配置输入数据的格式(这里是配置为GFS)：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -sf ungrib/Variable_Tables/Vtable.GFS Vtable</span><br></pre></td></tr></table></figure>

<p>然后把你的GFS输入数据链接过来：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./link_grib.csh path_where_you_placed_GFS_files</span><br></pre></td></tr></table></figure>

<p>之后就可以跑了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./ungrib.exe</span><br></pre></td></tr></table></figure>

<p>成功运行会输出如下信息</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pC7kZrD"><img src="https://s1.ax1x.com/2023/07/19/pC7kZrD.png" alt="pC7kZrD.png"></a></p>
<p>并且生成前缀为<code>FILE</code>的文件。</p>
<h3 id="整合数据–metgrid-exe"><a href="#整合数据–metgrid-exe" class="headerlink" title="整合数据–metgrid.exe"></a>整合数据–metgrid.exe</h3><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;metgrid</span><br><span class="line"> fg_name = <span class="string">&#x27;FILE&#x27;</span></span><br><span class="line"> io_form_metgrid = <span class="number">2</span>,</span><br></pre></td></tr></table></figure>

<p>运行成功显示如下信息：</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pC7kQPI"><img src="https://s1.ax1x.com/2023/07/19/pC7kQPI.png" alt="pC7kQPI.png"></a></p>
<p>生成前缀为<code>met_em*</code>的文件。</p>
<p>然后就可以作为输入文件跑WRF了。</p>
<h2 id="运行WRF"><a href="#运行WRF" class="headerlink" title="运行WRF"></a>运行WRF</h2><p>WRF运行需要跑两个程序，如果是真实数据，则都在<code>WRF/test/em_real</code>目录下。</p>
<p>首先将WPS输出的met_em*文件链接到当前目录下(当然直接复制也没问题)：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -sf ../../../WPS/met_em* .</span><br></pre></td></tr></table></figure>

<h3 id="WRF-namelist-input配置"><a href="#WRF-namelist-input配置" class="headerlink" title="WRF namelist.input配置"></a>WRF namelist.input配置</h3><p>配置当前目录下的namelist.input，具体<a target="_blank" rel="noopener" href="https://www2.mmm.ucar.edu/wrf/users/namelist_best_prac_wrf.html">参数解释</a>。</p>
<p>这里比WPS更复杂，而且需要对参数有更正确的理解才能正确输出数据，因此只做简单介绍。</p>
<p>本次配置的namelist：</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">&amp;time_control</span><br><span class="line">run_days                            = <span class="number">0</span>,</span><br><span class="line">run_hours                           = <span class="number">03</span>,</span><br><span class="line">run_minutes                         = <span class="number">30</span>,</span><br><span class="line">run_seconds                         = <span class="number">0</span>,</span><br><span class="line">start_year                          = <span class="number">2022</span>, <span class="number">2000</span>, <span class="number">2000</span>,</span><br><span class="line">start_month                         = <span class="number">06</span>,   <span class="number">01</span>,   <span class="number">01</span>,</span><br><span class="line">start_day                           = <span class="number">13</span>,   <span class="number">24</span>,   <span class="number">24</span>,</span><br><span class="line">start_hour                          = <span class="number">09</span>,   <span class="number">12</span>,   <span class="number">12</span>,</span><br><span class="line">end_year                            = <span class="number">2022</span>, <span class="number">2000</span>, <span class="number">2000</span>,</span><br><span class="line">end_month                           = <span class="number">06</span>,   <span class="number">01</span>,   <span class="number">01</span>,</span><br><span class="line">end_day                             = <span class="number">13</span>,   <span class="number">25</span>,   <span class="number">25</span>,</span><br><span class="line">end_hour                            = <span class="number">12</span>,   <span class="number">12</span>,   <span class="number">12</span>,</span><br><span class="line">interval_seconds                    = <span class="number">9600</span>,</span><br><span class="line">input_from_file                     = .true.,.true.,.true.,</span><br><span class="line">history_interval                    = <span class="number">60</span>,  <span class="number">60</span>,   <span class="number">60</span>,</span><br><span class="line">frames_per_outfile                  = <span class="number">1</span>, <span class="number">1000</span>, <span class="number">1000</span>,</span><br><span class="line">restart                             = .false.,</span><br><span class="line">restart_interval                    = <span class="number">1000</span>,</span><br><span class="line">io_form_history                     = <span class="number">2</span></span><br><span class="line">io_form_restart                     = <span class="number">2</span></span><br><span class="line">io_form_input                       = <span class="number">2</span></span><br><span class="line">io_form_boundary                    = <span class="number">2</span></span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;domains</span><br><span class="line">time_step                           = <span class="number">0</span>,</span><br><span class="line">time_step_fract_num                 = <span class="number">1</span>,</span><br><span class="line">time_step_fract_den                 = <span class="number">10</span>,</span><br><span class="line">max_dom                             = <span class="number">1</span>,</span><br><span class="line">e_we                                = <span class="number">100</span>,    <span class="number">112</span>,   <span class="number">94</span>,</span><br><span class="line">e_sn                                = <span class="number">100</span>,    <span class="number">97</span>,    <span class="number">91</span>,</span><br><span class="line">e_vert                              = <span class="number">34</span>,    <span class="number">33</span>,    <span class="number">33</span>,</span><br><span class="line">p_top_requested                     = <span class="number">5000</span>,</span><br><span class="line">num_metgrid_levels                  = <span class="number">34</span>,</span><br><span class="line">num_metgrid_soil_levels             = <span class="number">4</span>,</span><br><span class="line">dx                                  = <span class="number">100</span>, <span class="number">10000</span>,  <span class="number">3333.33</span>,</span><br><span class="line">dy                                  = <span class="number">100</span>, <span class="number">10000</span>,  <span class="number">3333.33</span>,</span><br><span class="line">grid_id                             = <span class="number">1</span>,     <span class="number">2</span>,     <span class="number">3</span>,</span><br><span class="line">parent_id                           = <span class="number">0</span>,     <span class="number">1</span>,     <span class="number">2</span>,</span><br><span class="line">i_parent_start                      = <span class="number">1</span>,     <span class="number">31</span>,    <span class="number">30</span>,</span><br><span class="line">j_parent_start                      = <span class="number">1</span>,     <span class="number">17</span>,    <span class="number">30</span>,</span><br><span class="line">parent_grid_ratio                   = <span class="number">1</span>,     <span class="number">3</span>,     <span class="number">3</span>,</span><br><span class="line">parent_time_step_ratio              = <span class="number">1</span>,     <span class="number">3</span>,     <span class="number">3</span>,</span><br><span class="line">feedback                            = <span class="number">1</span>,</span><br><span class="line">smooth_option                       = <span class="number">0</span></span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;physics</span><br><span class="line">physics_suite                       = <span class="string">&#x27;CONUS&#x27;</span></span><br><span class="line">mp_physics                          = -<span class="number">1</span>,    -<span class="number">1</span>,    -<span class="number">1</span>,</span><br><span class="line">cu_physics                          = -<span class="number">1</span>,    -<span class="number">1</span>,     <span class="number">0</span>,</span><br><span class="line">ra_lw_physics                       = -<span class="number">1</span>,    -<span class="number">1</span>,    -<span class="number">1</span>,</span><br><span class="line">ra_sw_physics                       = -<span class="number">1</span>,    -<span class="number">1</span>,    -<span class="number">1</span>,</span><br><span class="line">bl_pbl_physics                      = -<span class="number">1</span>,    -<span class="number">1</span>,    -<span class="number">1</span>,</span><br><span class="line">sf_sfclay_physics                   = -<span class="number">1</span>,    -<span class="number">1</span>,    -<span class="number">1</span>,</span><br><span class="line">sf_surface_physics                  = -<span class="number">1</span>,    -<span class="number">1</span>,    -<span class="number">1</span>,</span><br><span class="line">radt                                = <span class="number">30</span>,    <span class="number">30</span>,    <span class="number">30</span>,</span><br><span class="line">bldt                                = <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">cudt                                = <span class="number">5</span>,     <span class="number">5</span>,     <span class="number">5</span>,</span><br><span class="line">icloud                              = <span class="number">1</span>,</span><br><span class="line">num_land_cat                        = <span class="number">21</span>,</span><br><span class="line">sf_urban_physics                    = <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;fdda</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;dynamics</span><br><span class="line">hybrid_opt                          = <span class="number">2</span>, </span><br><span class="line">w_damping                           = <span class="number">1</span>,</span><br><span class="line">diff_opt                            = <span class="number">1</span>,      <span class="number">1</span>,      <span class="number">1</span>,</span><br><span class="line">km_opt                              = <span class="number">4</span>,      <span class="number">4</span>,      <span class="number">4</span>,</span><br><span class="line">diff_6th_opt                        = <span class="number">0</span>,      <span class="number">0</span>,      <span class="number">0</span>,</span><br><span class="line">diff_6th_factor                     = <span class="number">0.12</span>,   <span class="number">0.12</span>,   <span class="number">0.12</span>,</span><br><span class="line">base_temp                           = <span class="number">290.</span></span><br><span class="line">damp_opt                            = <span class="number">3</span>,</span><br><span class="line">zdamp                               = <span class="number">5000.</span>,  <span class="number">5000.</span>,  <span class="number">5000.</span>,</span><br><span class="line">dampcoef                            = <span class="number">0.2</span>,    <span class="number">0.2</span>,    <span class="number">0.2</span></span><br><span class="line">khdif                               = <span class="number">0</span>,      <span class="number">0</span>,      <span class="number">0</span>,</span><br><span class="line">kvdif                               = <span class="number">0</span>,      <span class="number">0</span>,      <span class="number">0</span>,</span><br><span class="line">non_hydrostatic                     = .true., .true., .true.,</span><br><span class="line">moist_adv_opt                       = <span class="number">1</span>,      <span class="number">1</span>,      <span class="number">1</span>,     </span><br><span class="line">scalar_adv_opt                      = <span class="number">1</span>,      <span class="number">1</span>,      <span class="number">1</span>,     </span><br><span class="line">gwd_opt                             = <span class="number">1</span>,</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;bdy_control</span><br><span class="line">spec_bdy_width                      = <span class="number">5</span>,</span><br><span class="line">specified                           = .true.</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;grib2</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;namelist_quilt</span><br><span class="line">nio_tasks_per_group = <span class="number">0</span>,</span><br><span class="line">nio_groups = <span class="number">1</span>,</span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<p>与WPS的namelist类似，start_year,start_month,end_day之类的参数写<strong>输入的GFS数据起止时间</strong>。</p>
<h4 id="domain配置"><a href="#domain配置" class="headerlink" title="domain配置"></a>domain配置</h4><p><em>&amp;domain</em>是最重要的配置，其中需要修改的参数有好几个，而且需要仔细修改，否则直接影响输出数据质量：</p>
<p><strong>time_step</strong>是时间积分步长，也就是每次算法的输入时间参数，与分辨率直接对应，非常重要。</p>
<p>很长时间里我一直跑不出目标分辨率的数据，长期报错CFL:</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pCbnqun"><img src="https://s1.ax1x.com/2023/07/21/pCbnqun.png" alt="pCbnqun.png"></a></p>
<p>官方文档对这个参数配置的说明如下：</p>
<blockquote>
<p><strong>Best Practice</strong><br>It is recommended to use a value of 5-6xDX (in km) for a typical case. If you are using many vertical levels and&#x2F;or with map-scale-factors much larger than 1, you will need to use a smaller time_step. If you are getting CFL errors that stop your run, this means your run has become unstable and you may need to decrease this value to about 4xDX (or perhaps even 3xDX). It makes things easier if you use a time step that evenly divides into your history_interval, so that your output times will be evenly spaced.</p>
<p>翻译：</p>
<p>在典型情况下，建议使用 5-6xDX 值（以公里为单位）。如果使用多个垂直层和&#x2F;或地图比例因子远大于 1，则需要使用更小的时间步长。如果出现导致运行停止的 CFL 错误，这意味着运行变得不稳定，您可能需要将该值减小到约 4xDX（甚至 3xDX）。如果您使用的时间步长与历史时间间隔相等，那么输出时间的间隔也会相等。</p>
</blockquote>
<p>也就是说一般使用5Dx或6Dx，但老师要求我跑100m分辨率的数据（即Dx为100m），所以一开始用500，之后一直改到100都不行，一直报错CFL。请教了专家才知道，<strong>当分辨率远远小于一公里时，需要将time_step设置为0.1</strong>(比我想象的还小的多啊！)，就可以正常运行了。</p>
<p>另外设置时间步长设置0.1是不能直接设置time_step的，而且应该写成这种形式：</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">time_step                           = <span class="number">0</span>,</span><br><span class="line">time_step_fract_num                 = <span class="number">1</span>,</span><br><span class="line">time_step_fract_den                 = <span class="number">10</span>,</span><br></pre></td></tr></table></figure>

<p>time_step_fract_num是分子，time_step_fract_den 是分母。</p>
<p>其他与CFL相关的报错可以参考这个<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42487488/article/details/119703861">原因和解决合集</a>。</p>
<p>e_we和e_sn是网格范围，dx和dy是分辨率，这两个不但参数名与WPS相同，配置的值也<strong>需要与WPS中配置相同</strong>，否则会在.&#x2F;read.exe时报错：</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pCbuVUK"><img src="https://s1.ax1x.com/2023/07/21/pCbuVUK.png" alt="pCbuVUK.png"></a></p>
<h3 id="判断运行情况"><a href="#判断运行情况" class="headerlink" title="判断运行情况"></a>判断运行情况</h3><p>配置好之后跑real.exe:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mpirun -np 1 ./real.exe</span><br></pre></td></tr></table></figure>

<p>如果没装mpirun，直接用<code>./real.exe</code>应该也可以。</p>
<p>如果输出如下则说明成功运行：</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pC7kTsO"><img src="https://s1.ax1x.com/2023/07/19/pC7kTsO.png" alt="pC7kTsO.png"></a></p>
<p>之后就是WRF真正的可执行程序了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mpirun -np 8 ./wrf.exe</span><br></pre></td></tr></table></figure>

<p>输出的<code>wrfout*</code>文件就是WRF输出文件了，虽然没有后缀名，但实际上就是<strong>NC格式</strong>的。</p>
<h2 id="问题总结"><a href="#问题总结" class="headerlink" title="问题总结"></a>问题总结</h2><h3 id="WRF编译失败"><a href="#WRF编译失败" class="headerlink" title="WRF编译失败"></a>WRF编译失败</h3><p><a target="_blank" rel="noopener" href="https://imgse.com/i/pChRHQ1"><img src="https://s1.ax1x.com/2023/07/13/pChRHQ1.png" alt="pChRHQ1.png"></a></p>
<p>这种报错是netcdf这个依赖存在，但与编译不匹配，因此是版本问题。</p>
<p>升级netcdf版本或者降低WRF版本，让依赖与软件对应，然后修改对应环境变量即可。</p>

        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2023/07/24/Thinking-of-Sakura-no-Uta/"
      title="《樱之诗》随想"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        《樱之诗》随想
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/2023/07/07/The-exp-of-Redis-unauthorized/"
      title="Redis未授权访问原理及利用"
     >

    <p class="title-text">
      
        Redis未授权访问原理及利用
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>

 
    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2023 Kizureina<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn" onclick="topFunction()">
        <span class="material-symbols-rounded">keyboard_arrow_up</span>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.style.opacity = 1;
        } else {
            btn.style.opacity = 0;
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
